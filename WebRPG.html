<!DOCTYPE html>
<html lang="de">
<head>
	<title>processing.js</title>
	<script type="text/javascript" src="js/processing-1.4.1.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script type="text/javascript">
		var bound = false;
		var pjs;
		var socket;

		function connectToServer() {
			socket = io.connect('http://localhost:80/');
			//socket = io.connect('http://webrpg.jit.su/');
			var id;
			socket.on('hello', function(data) {
				console.log('Javascript: %s connected', data.id);
				id = data.id;
			});

			socket.on('userList', function(data) {
				console.log('Javascript: PlayerList received');
				console.log(data);
				data.forEach(function (player) {
					if(id!=player.id){
						pjs.createPlayer(player.id, player.x, player.y, player.d, player.map);
					}
				});
			});

			socket.on('removePlayer', function(data) {
				console.log('Javascript: Player %s removed from List', data);
	      		pjs.removePlayer(data);
			});

			socket.on('addPlayer', function(data) {
				console.log('Javascript: Player %s add to List', data.id);
	      		pjs.createPlayer(data.id, data.x, data.y, data.d, data.map);
			});

			socket.on('movePlayer', function(data) {
//				console.log('Javascript: move Player %s to (%s:%s) on Map %s', data.id, data.x, data.y, data.map);
	      		pjs.movePlayer(data.id, data.x, data.y, data.d, data.map);
			});
		}

		function bindJavascript() {
			// console.log("in");
			pjs = Processing.getInstanceById('canvas2');
			if(pjs!=null) {
				pjs.bindJavascript(this);
				bound = true;
				connectToServer();
			}
			if(!bound) setTimeout(bindJavascript, 2000);
			// console.log("out"); 
		}

		bindJavascript();

		function playerMoved(x, y, d, map) {
//			console.log('Javascript: Player position (%s:%s) received (from processing.js)', x, y);
			socket.emit('playerPosition', {x: x , y: y, d: d, map: map});
		}
	</script>
	<link rel="stylesheet" href="css/map.css">
</head>
<body>
<!-- 	<form action="http://de.selfhtml.org/cgi-bin/comments.pl">
     	<p>Player: <input name="player" type="text" size="30" maxlength="30"><input type="submit" value=" Los! "></p>
	</form> -->
	<canvas id="canvas2" class="canvas" data-processing-sources="src/Main.java src/Water.java src/Tree.java src/Player.java 
							src/Map.java src/Maps.java src/Tile.java"></canvas>
</body>
</html>
