<!DOCTYPE html>
<html lang="de">
<head>
	<title>processing.js</title>

	<script src="js/jquery-1.8.2.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/processing-1.4.1.js"></script>
	<script src="/socket.io/socket.io.js"></script>


	<script type="text/javascript">


		var bound = false;
		var pjs;
		var socket;


		function connectToServer() {
			socket = io.connect('http://localhost:8080/');
			//socket = io.connect('http://webrpg.jit.su/');
			var id;
			socket.on('hello', function(data) {
				console.log('Javascript: %s connected', data.id);
				id = data.id;
			});

			socket.on('userList', function(data) {
				console.log('Javascript: PlayerList received');
				console.log(data);
				data.forEach(function (player) {
					if(id!=player.id){
						pjs.createPlayer(player.id, player.x, player.y, player.d, player.map);
					}
				});
			});

			socket.on('removePlayer', function(data) {
				console.log('Javascript: Player %s removed from List', data);
	      		pjs.removePlayer(data);
			});

			socket.on('addPlayer', function(data) {
				console.log('Javascript: Player %s add to List', data.id);
	      		pjs.createPlayer(data.id, data.x, data.y, data.d, data.map);
			});

			socket.on('movePlayer', function(data) {
//				console.log('Javascript: move Player %s to (%s:%s) on Map %s', data.id, data.x, data.y, data.map);
	      		pjs.movePlayer(data.id, data.x, data.y, data.d, data.map);
			});
		}

		function bindJavascript() {
			// console.log("in");
			pjs = Processing.getInstanceById('canvas2');
			if(pjs!=null) {
				pjs.bindJavascript(this);
				bound = true;
				connectToServer();
			}
			if(!bound) setTimeout(bindJavascript, 2000);
			// console.log("out"); 
		}

		bindJavascript();

		function playerMoved(x, y, d, map) {
//	console.log('Javascript: Player position (%s:%s) received (from processing.js)', x, y);
			socket.emit('playerPosition', {x: x , y: y, d: d, map: map});
		}


	</script>

	<script type="text/javascript">
		
		$(document).ready(function() {
			$("canvas").hide();
			$("#chat").hide();
	    	$("#loginbutton").click(function ( event ) {

	    	if($("#input1").val() != "")
	    	{
	    		loginname = $("#input1").val();
	    		$("#login").fadeOut('slow');
	      		$('canvas').fadeIn(2500);
	      		$('#chat').fadeIn(2500);

	    	}
	    	});
 		});	

	</script>

	
	<link rel="stylesheet" href="css/map.css">



</head>
<body>
<!-- 	<form action="http://de.selfhtml.org/cgi-bin/comments.pl">
     	<p>Player: <input name="player" type="text" size="30" maxlength="30"><input type="submit" value=" Los! "></p>
	</form> -->
	<div id="login">
		<p>Willkommen bei "Name kommt noch"!</p>
		<input id="input1" type="text" name="" value="" />
		<button id="loginbutton" type="button" name="" value="">Login</button>
	</div>

	<canvas id="canvas2" class="canvas" data-processing-sources="src/Main.java src/Water.java src/Tree.java src/Player.java 
							src/Map.java src/Maps.java src/Tile.java"></canvas>

	<div id="chat">
		<p>
			<textarea id="chatausgabe" cols="80" rows="10" readonly></textarea> 
		</p>
		<p>
			<textarea id="chateingabe" cols="50" rows="1"></textarea> 
		</p>
		<button id="loginbutton" type="button" name="" value="">Senden</button>

	</div>

	</canvas>



</body>
</html>
